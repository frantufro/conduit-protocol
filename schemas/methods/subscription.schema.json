{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://cauce-protocol.org/schemas/v1/methods/subscription.schema.json",
  "title": "Cauce Subscription Management",
  "description": "Subscription management methods",
  "$defs": {
    "approveRequest": {
      "type": "object",
      "required": ["subscription_id"],
      "properties": {
        "subscription_id": {
          "type": "string",
          "pattern": "^sub_[a-zA-Z0-9_]+$",
          "description": "Subscription to approve"
        },
        "restrictions": {
          "$ref": "#/$defs/restrictions"
        }
      },
      "additionalProperties": false
    },
    "denyRequest": {
      "type": "object",
      "required": ["subscription_id"],
      "properties": {
        "subscription_id": {
          "type": "string",
          "pattern": "^sub_[a-zA-Z0-9_]+$",
          "description": "Subscription to deny"
        },
        "reason": {
          "type": "string",
          "maxLength": 500,
          "description": "Reason for denial"
        }
      },
      "additionalProperties": false
    },
    "revokeRequest": {
      "type": "object",
      "required": ["subscription_id"],
      "properties": {
        "subscription_id": {
          "type": "string",
          "pattern": "^sub_[a-zA-Z0-9_]+$",
          "description": "Subscription to revoke"
        },
        "reason": {
          "type": "string",
          "maxLength": 500,
          "description": "Reason for revocation"
        }
      },
      "additionalProperties": false
    },
    "listRequest": {
      "type": "object",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["active", "pending_approval", "denied", "all"],
          "default": "active",
          "description": "Filter by status"
        },
        "client_id": {
          "type": "string",
          "description": "Filter by client ID"
        },
        "topic_pattern": {
          "type": "string",
          "description": "Filter by topic pattern"
        },
        "limit": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 50,
          "description": "Maximum number of results"
        },
        "offset": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "description": "Pagination offset"
        }
      },
      "additionalProperties": false
    },
    "listResponse": {
      "type": "object",
      "required": ["subscriptions", "total"],
      "properties": {
        "subscriptions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/subscriptionInfo"
          }
        },
        "total": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of matching subscriptions"
        },
        "has_more": {
          "type": "boolean",
          "description": "Whether more results are available"
        }
      },
      "additionalProperties": false
    },
    "statusNotification": {
      "type": "object",
      "required": ["subscription_id", "status"],
      "properties": {
        "subscription_id": {
          "type": "string",
          "pattern": "^sub_[a-zA-Z0-9_]+$"
        },
        "status": {
          "type": "string",
          "enum": ["active", "pending_approval", "denied", "revoked", "expired"]
        },
        "topics": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "expires_at": {
          "type": "string",
          "format": "date-time"
        },
        "reason": {
          "type": "string",
          "description": "Reason for status change (if denied/revoked)"
        }
      },
      "additionalProperties": false
    },
    "restrictions": {
      "type": "object",
      "properties": {
        "topics": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Restrict to these topics (subset of requested)"
        },
        "expires_at": {
          "type": "string",
          "format": "date-time",
          "description": "Subscription expiration time"
        },
        "rate_limit": {
          "type": "object",
          "properties": {
            "max_signals_per_minute": {
              "type": "integer",
              "minimum": 1
            },
            "max_signals_per_hour": {
              "type": "integer",
              "minimum": 1
            }
          },
          "description": "Rate limits for this subscription"
        }
      },
      "additionalProperties": false
    },
    "subscriptionInfo": {
      "type": "object",
      "required": ["subscription_id", "status", "topics", "client_id", "created_at"],
      "properties": {
        "subscription_id": {
          "type": "string",
          "pattern": "^sub_[a-zA-Z0-9_]+$"
        },
        "status": {
          "type": "string",
          "enum": ["active", "pending_approval", "denied", "revoked", "expired"]
        },
        "topics": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "client_id": {
          "type": "string"
        },
        "client_type": {
          "type": "string",
          "enum": ["adapter", "agent", "a2a_agent"]
        },
        "transport": {
          "type": "string",
          "enum": ["websocket", "sse", "polling", "long_polling", "webhook"]
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "expires_at": {
          "type": "string",
          "format": "date-time"
        },
        "e2e_enabled": {
          "type": "boolean"
        }
      },
      "additionalProperties": false
    }
  }
}
